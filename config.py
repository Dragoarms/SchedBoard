"""
Configuration module for JMP Tracker
Contains all configuration settings and constants
"""

import pytz
from datetime import datetime

# Timezone configuration
LOCAL_TIMEZONE = pytz.timezone('Africa/Lagos')  # UTC+1 West Africa Time

# Language configuration
LANGUAGES = {
    'en': {
        'app_title': 'JMP Tracker',
        'dashboard': 'ğŸ  Dashboard',
        'departures': 'ğŸš¶ Departures',
        'arrivals': 'ğŸƒ Arrivals',
        'management': 'ğŸ“Š Management',
        'refresh': 'ğŸ”„ Refresh',
        'show_map': 'ğŸ—ºï¸ Show Map View',
        'hide_map': 'Hide Map',
        'active_departures': 'Active Departures',
        'all_in_camp': 'âœ… All personnel are in camp!',
        'overdue_alert': 'âš ï¸ **ALERT: {count} OVERDUE PERSONNEL**',
        'currently_out': 'Currently Out',
        'overdue': 'Overdue',
        'total_active': 'Total Active',
        'with_gps': 'With GPS',
        'no_gps': 'No GPS',
        'log_departure': 'Log Departure',
        'mark_returned': 'âœ… Returned',
        'extend_time': 'Extend Time',
        'name': 'Name',
        'destination': 'Destination',
        'phone': 'Phone Number',
        'supervisor': 'Supervisor',
        'company': 'Company',
        'expected_duration': 'Expected Duration',
        'hours': 'Hours',
        'departure_time': 'Departure',
        'expected_return': 'Expected Return',
        'add_new_person': 'â• Add New Person',
        'enter_name': 'Enter Name',
        'capture_location': 'ğŸ“ Capture departure location (optional)',
        'get_current_location': 'ğŸ“ Get Current Location',
        'success_departure': 'âœ… {name} logged as departed to {destination}',
        'location_captured': 'ğŸ“ Location captured',
        'error_name_dest': 'Please enter name and destination',
        'error_destination': 'Please enter destination',
        'error_select_name': 'Please select or enter a name',
        'current_status': 'ğŸ“Š Current Status',
        'group_departure': 'Group Departure',
        'select_group': 'Select Existing Group',
        'create_group': 'Create New Group',
        'group_name': 'Group Name',
        'members': 'Members',
        'responsible_person': 'Responsible Person',
        'one_per_line': '(one per line)',
        'everyone_in_camp': 'âœ… Everyone is in camp!',
        'individual_returns': 'Individual Returns',
        'group_returns': 'Group Returns',
        'overdue_by': 'Overdue by {hours}h {minutes}m',
        'time_remaining': '{hours}h {minutes}m remaining',
        'due_now': 'Due now',
        'departed_at': 'Departed: {time}',
        'expected_at': 'Expected: {time}',
        'no_active_groups': 'No active group departures',
        'members_out': '{count} members out',
        'some_overdue': 'âš ï¸ Some members are overdue!',
        'mark_group_returned': 'âœ… Mark Entire Group as Returned',
        'group_returned_success': 'All members of \'{name}\' marked as returned',
        'select_person': 'Select Person',
        'current_expected_return': 'Current Expected Return',
        'hours_to_extend': 'Hours to Extend',
        'share_location': 'Optional: Share current location',
        'extended_success': 'âœ… Extended {name}\'s return time by {hours} hours',
        'location_recorded': 'ğŸ“ Location recorded: {lat:.6f}, {lon:.6f}',
        'password': 'Password',
        'password_incorrect': 'ğŸ˜• Password incorrect',
        'active_deps_tab': 'ğŸ“ Active Departures',
        'map_view_tab': 'ğŸ—ºï¸ Map View',
        'manifest_tab': 'ğŸ“‹ Personnel Manifest',
        'groups_tab': 'ğŸ‘¥ Groups',
        'statistics_tab': 'ğŸ“ˆ Statistics',
        'personnel_status': 'Personnel Status',
        'on_time': 'On Time',
        'due_soon': 'Due Soon (<30min)',
        'roads_tracks': 'Roads/Tracks',
        'error': 'Error',
        'warning': 'Warning',
        'info': 'Information',
        'success': 'Success',
        'loading': 'Loading...',
        'no_data': 'No data available',
        'confirm': 'Confirm',
        'cancel': 'Cancel',
        'save': 'Save',
        'delete': 'Delete',
        'edit': 'Edit',
        'add': 'Add',
        'search': 'Search',
        'filter': 'Filter',
        'export': 'Export',
        'import': 'Import',
        'settings': 'Settings',
        'language': 'Language',
        'help': 'Help',
        'about': 'About',
        'logout': 'Logout',
        'welcome': 'Welcome',
        'scan_departure': 'Scan to log departure:',
        'scan_arrival': 'Scan to check in:',
        'getting_location': 'Getting location...',
        'geolocation_not_supported': 'Geolocation is not supported by this browser',
        'location_permission_denied': 'Location permission denied',
        'location_unavailable': 'Location information unavailable',
        'location_timeout': 'Location request timed out',
        'manual_gps_entry': 'Manual GPS Entry',
        'manual_gps_info': 'If automatic geolocation does not work, enter coordinates manually',
        'use_these_coordinates': 'Use these coordinates',
        'how_to_share_location': 'How to share your location',
        'on_phone': 'On Phone',
        'open_maps_app': 'Open Google Maps or Apple Maps',
        'long_press_location': 'Long press on your location',
        'copy_coordinates': 'Copy the coordinates',
        'paste_below': 'Paste below',
        'on_computer': 'On Computer',
        'open_google_maps': 'Open Google Maps',
        'right_click_location': 'Right-click on your location',
        'click_coordinates': 'Click on the coordinates shown',
        'or_paste_coordinates': 'Or paste coordinates',
        'paste_from_maps': 'Paste from Google Maps',
        'invalid_coordinates': 'Invalid coordinates format',
        'departure_type': 'Departure Type',
        'individual': 'Individual',
        'group': 'Group',
        'start_typing': 'Start typing to filter names',
        'destination_for_group': 'Destination for entire group',
        'log_group_departure': 'Log Group Departure',
        'group_departure_success': '{name} logged as departed to {destination}',
        'group_option': 'Group Option',
        'select_members': 'Select Members',
        'select_multiple': 'Select multiple people',
        'add_new_members': 'Add New Members',
        'new_members': 'New Members',
        'group_created': 'Group \'{name}\' created with {count} members',
        'fill_all_fields': 'Please fill in all fields',
        'marked_returned': 'marked as returned',
        'active_groups': 'Active Group Departures',
        'select_person_extend': 'Select a person to extend their expected return time',
        'error_connecting_sheets': 'Error connecting to Google Sheets',
        'select_action': 'Select Action',
        'view_only': 'View Only',
        'select_to_return': 'Select personnel to mark as returned',
        'mark_selected_returned': 'Mark Selected as Returned',
        'extend_selected': 'Extend Selected',
        'total_out': 'Total Out',
        'avg_time_remaining': 'Avg Time Remaining',
        'monitor_manage': 'Monitor and manage all personnel',
        'show_overdue': 'Show Overdue',
        'show_on_time': 'Show On Time',
        'show_no_gps': 'Show No GPS',
        'no_active_personnel': 'No active personnel to display',
        'personnel_no_gps': 'Personnel without GPS',
        'no_personnel': 'No personnel in manifest',
        'search_personnel': 'Search Personnel',
        'total_personnel': 'Total Personnel',
        'companies': 'Companies', 
        'supervisors': 'Supervisors',
        'export_csv': 'Export to CSV',
        'download_csv': 'Download CSV',
        'no_groups': 'No groups created yet',
        'current_members': 'Current Members',
        'edit_group': 'Edit Group',
        'add_members': 'Add Members to Group',
        'remove_members': 'Remove Members from Group',
        'change_responsible': 'Change Responsible Person',
        'update_group': 'Update Group',
        'group_updated': 'Group updated successfully',
        'group_empty': 'Group cannot be empty',
        'overall_statistics': 'Overall Statistics',
        'total_departures': 'Total Departures',
        'completed_trips': 'Completed Trips',
        'avg_extensions': 'Avg Extensions',
        'time_statistics': 'Time Statistics',
        'avg_trip_duration': 'Avg Trip Duration',
        'longest_trip': 'Longest Trip',
        'total_overdue_incidents': 'Total Overdue Incidents',
        'popular_destinations': 'Popular Destinations',
        'company_statistics': 'Company Statistics',
        'last_update': 'Last Update',
        'how_to_share_location': 'How to share location',
        'on_phone': 'On Phone',
        'open_maps_app': 'Open Maps app',
        'long_press_location': 'Long press your location',
        'copy_coordinates': 'Copy coordinates',
        'paste_below': 'Paste below',
        'on_computer': 'On Computer',
        'open_google_maps': 'Open Google Maps',
        'right_click_location': 'Right-click your location',
        'click_coordinates': 'Click the coordinates',
        'or_paste_coordinates': 'Or paste coordinates',
        'paste_from_maps': 'Paste from Maps',
        'invalid_coordinates': 'Invalid coordinate format'
    },
    'fr': {
        'app_title': 'Suivi JMP',
        'dashboard': 'ğŸ  Tableau de bord',
        'departures': 'ğŸš¶ DÃ©parts',
        'arrivals': 'ğŸƒ ArrivÃ©es',
        'management': 'ğŸ“Š Gestion',
        'refresh': 'ğŸ”„ Actualiser',
        'show_map': 'ğŸ—ºï¸ Afficher la carte',
        'hide_map': 'Masquer la carte',
        'active_departures': 'DÃ©parts actifs',
        'all_in_camp': 'âœ… Tout le personnel est au camp!',
        'overdue_alert': 'âš ï¸ **ALERTE: {count} PERSONNEL EN RETARD**',
        'currently_out': 'Actuellement sorti',
        'overdue': 'En retard',
        'total_active': 'Total actif',
        'with_gps': 'Avec GPS',
        'no_gps': 'Sans GPS',
        'log_departure': 'Enregistrer le dÃ©part',
        'mark_returned': 'âœ… RetournÃ©',
        'extend_time': 'Prolonger le temps',
        'name': 'Nom',
        'destination': 'Destination',
        'phone': 'NumÃ©ro de tÃ©lÃ©phone',
        'supervisor': 'Superviseur',
        'company': 'Entreprise',
        'expected_duration': 'DurÃ©e prÃ©vue',
        'hours': 'Heures',
        'departure_time': 'DÃ©part',
        'expected_return': 'Retour prÃ©vu',
        'add_new_person': 'â• Ajouter une nouvelle personne',
        'enter_name': 'Entrer le nom',
        'capture_location': 'ğŸ“ Capturer la position de dÃ©part (optionnel)',
        'get_current_location': 'ğŸ“ Obtenir la position actuelle',
        'success_departure': 'âœ… {name} enregistrÃ© comme parti vers {destination}',
        'location_captured': 'ğŸ“ Position capturÃ©e',
        'error_name_dest': 'Veuillez entrer le nom et la destination',
        'error_destination': 'Veuillez entrer la destination',
        'error_select_name': 'Veuillez sÃ©lectionner ou entrer un nom',
        'current_status': 'ğŸ“Š Statut actuel',
        'group_departure': 'DÃ©part de groupe',
        'select_group': 'SÃ©lectionner un groupe existant',
        'create_group': 'CrÃ©er un nouveau groupe',
        'group_name': 'Nom du groupe',
        'members': 'Membres',
        'responsible_person': 'Personne responsable',
        'one_per_line': '(un par ligne)',
        'everyone_in_camp': 'âœ… Tout le monde est au camp!',
        'individual_returns': 'Retours individuels',
        'group_returns': 'Retours de groupe',
        'overdue_by': 'En retard de {hours}h {minutes}m',
        'time_remaining': '{hours}h {minutes}m restant',
        'due_now': 'DÃ» maintenant',
        'departed_at': 'Parti: {time}',
        'expected_at': 'PrÃ©vu: {time}',
        'no_active_groups': 'Aucun dÃ©part de groupe actif',
        'members_out': '{count} membres sortis',
        'some_overdue': 'âš ï¸ Certains membres sont en retard!',
        'mark_group_returned': 'âœ… Marquer tout le groupe comme retournÃ©',
        'group_returned_success': 'Tous les membres de \'{name}\' marquÃ©s comme retournÃ©s',
        'select_person': 'SÃ©lectionner une personne',
        'current_expected_return': 'Retour prÃ©vu actuel',
        'hours_to_extend': 'Heures Ã  prolonger',
        'share_location': 'Optionnel: Partager la position actuelle',
        'extended_success': 'âœ… Temps de retour de {name} prolongÃ© de {hours} heures',
        'location_recorded': 'ğŸ“ Position enregistrÃ©e: {lat:.6f}, {lon:.6f}',
        'password': 'Mot de passe',
        'password_incorrect': 'ğŸ˜• Mot de passe incorrect',
        'active_deps_tab': 'ğŸ“ DÃ©parts actifs',
        'map_view_tab': 'ğŸ—ºï¸ Vue carte',
        'manifest_tab': 'ğŸ“‹ Registre du personnel',
        'groups_tab': 'ğŸ‘¥ Groupes',
        'statistics_tab': 'ğŸ“ˆ Statistiques',
        'personnel_status': 'Statut du personnel',
        'on_time': 'Ã€ temps',
        'due_soon': 'BientÃ´t dÃ» (<30min)',
        'roads_tracks': 'Routes/Pistes',
        'error': 'Erreur',
        'warning': 'Avertissement',
        'info': 'Information',
        'success': 'SuccÃ¨s',
        'loading': 'Chargement...',
        'no_data': 'Aucune donnÃ©e disponible',
        'confirm': 'Confirmer',
        'cancel': 'Annuler',
        'save': 'Enregistrer',
        'delete': 'Supprimer',
        'edit': 'Modifier',
        'add': 'Ajouter',
        'search': 'Rechercher',
        'filter': 'Filtrer',
        'export': 'Exporter',
        'import': 'Importer',
        'settings': 'ParamÃ¨tres',
        'language': 'Langue',
        'help': 'Aide',
        'about': 'Ã€ propos',
        'logout': 'DÃ©connexion',
        'welcome': 'Bienvenue',
        'scan_departure': 'Scanner pour enregistrer le dÃ©part:',
        'scan_arrival': 'Scanner pour enregistrer l\'arrivÃ©e:',
        'getting_location': 'Obtention de la position...',
        'geolocation_not_supported': 'La gÃ©olocalisation n\'est pas supportÃ©e par ce navigateur',
        'location_permission_denied': 'Permission de localisation refusÃ©e',
        'location_unavailable': 'Information de localisation non disponible',
        'location_timeout': 'DÃ©lai de demande de localisation dÃ©passÃ©',
        'manual_gps_entry': 'EntrÃ©e GPS manuelle',
        'manual_gps_info': 'Si la gÃ©olocalisation automatique ne fonctionne pas, entrez les coordonnÃ©es manuellement',
        'use_these_coordinates': 'Utiliser ces coordonnÃ©es',
        'how_to_share_location': 'Comment partager votre position',
        'on_phone': 'Sur tÃ©lÃ©phone',
        'open_maps_app': 'Ouvrez Google Maps ou Apple Maps',
        'long_press_location': 'Appuyez longuement sur votre position',
        'copy_coordinates': 'Copiez les coordonnÃ©es',
        'paste_below': 'Collez ci-dessous',
        'on_computer': 'Sur ordinateur',
        'open_google_maps': 'Ouvrez Google Maps',
        'right_click_location': 'Clic droit sur votre position',
        'click_coordinates': 'Cliquez sur les coordonnÃ©es affichÃ©es',
        'or_paste_coordinates': 'Ou collez les coordonnÃ©es',
        'paste_from_maps': 'Collez depuis Google Maps',
        'invalid_coordinates': 'Format de coordonnÃ©es invalide',
        'departure_type': 'Type de dÃ©part',
        'individual': 'Individuel',
        'group': 'Groupe',
        'start_typing': 'Commencez Ã  taper pour filtrer',
        'destination_for_group': 'Destination pour tout le groupe',
        'log_group_departure': 'Enregistrer le dÃ©part du groupe',
        'group_departure_success': '{name} enregistrÃ© comme parti vers {destination}',
        'group_option': 'Option de groupe',
        'select_members': 'SÃ©lectionner les membres',
        'select_multiple': 'SÃ©lectionnez plusieurs personnes',
        'add_new_members': 'Ajouter de nouveaux membres',
        'new_members': 'Nouveaux membres',
        'group_created': 'Groupe \'{name}\' crÃ©Ã© avec {count} membres',
        'fill_all_fields': 'Veuillez remplir tous les champs',
        'marked_returned': 'marquÃ© comme retournÃ©',
        'active_groups': 'DÃ©parts de groupe actifs',
        'select_person_extend': 'SÃ©lectionnez une personne pour prolonger son heure de retour prÃ©vue',
        'error_connecting_sheets': 'Erreur de connexion Ã  Google Sheets',
        'select_action': 'SÃ©lectionner une action',
        'view_only': 'Vue seule',
        'select_to_return': 'SÃ©lectionner le personnel Ã  marquer comme retournÃ©',
        'mark_selected_returned': 'Marquer la sÃ©lection comme retournÃ©e',
        'extend_selected': 'Prolonger la sÃ©lection',
        'total_out': 'Total sorti',
        'avg_time_remaining': 'Temps restant moyen',
        'monitor_manage': 'Surveiller et gÃ©rer tout le personnel',
        'show_overdue': 'Afficher en retard',
        'show_on_time': 'Afficher Ã  temps',
        'show_no_gps': 'Afficher sans GPS',
        'no_active_personnel': 'Aucun personnel actif Ã  afficher',
        'personnel_no_gps': 'Personnel sans GPS',
        'no_personnel': 'Aucun personnel dans le registre',
        'search_personnel': 'Rechercher le personnel',
        'total_personnel': 'Personnel total',
        'companies': 'Entreprises',
        'supervisors': 'Superviseurs',
        'export_csv': 'Exporter en CSV',
        'download_csv': 'TÃ©lÃ©charger CSV',
        'no_groups': 'Aucun groupe crÃ©Ã©',
        'current_members': 'Membres actuels',
        'edit_group': 'Modifier le groupe',
        'add_members': 'Ajouter des membres au groupe',
        'remove_members': 'Retirer des membres du groupe',
        'change_responsible': 'Changer la personne responsable',
        'update_group': 'Mettre Ã  jour le groupe',
        'group_updated': 'Groupe mis Ã  jour avec succÃ¨s',
        'group_empty': 'Le groupe ne peut pas Ãªtre vide',
        'overall_statistics': 'Statistiques gÃ©nÃ©rales',
        'total_departures': 'Total des dÃ©parts',
        'completed_trips': 'Voyages terminÃ©s',
        'avg_extensions': 'Extensions moyennes',
        'time_statistics': 'Statistiques temporelles',
        'avg_trip_duration': 'DurÃ©e moyenne du voyage',
        'longest_trip': 'Voyage le plus long',
        'total_overdue_incidents': 'Total des incidents en retard',
        'popular_destinations': 'Destinations populaires',
        'company_statistics': 'Statistiques par entreprise',
        'last_update': 'DerniÃ¨re mise Ã  jour',
        'how_to_share_location': 'Comment partager la position',
        'on_phone': 'Sur tÃ©lÃ©phone',
        'open_maps_app': 'Ouvrir Maps',
        'long_press_location': 'Appui long sur position',
        'copy_coordinates': 'Copier coordonnÃ©es',
        'paste_below': 'Coller ci-dessous',
        'on_computer': 'Sur ordinateur',
        'open_google_maps': 'Ouvrir Google Maps',
        'right_click_location': 'Clic droit sur position',
        'click_coordinates': 'Cliquer les coordonnÃ©es',
        'or_paste_coordinates': 'Ou coller coordonnÃ©es',
        'paste_from_maps': 'Coller depuis Maps',
        'invalid_coordinates': 'Format de coordonnÃ©es invalide'
    }
}

# UI Configuration
PAGE_CONFIG = {
    "page_title": "JMP Tracker",
    "page_icon": "ğŸ•ï¸",
    "layout": "wide",
    "initial_sidebar_state": "collapsed"
}

# GitHub repository URLs
GITHUB_BASE_URL = "https://raw.githubusercontent.com/Dragoarms/SchedBoard/main"
LOGO_URL = f"{GITHUB_BASE_URL}/Icons/logo.ico"
KMZ_URL = f"{GITHUB_BASE_URL}/MapFeatures/tracks.kmz"

# QR Code URLs
QR_BASE_URL = "https://api.qrserver.com/v1/create-qr-code/?size=150x150&data="
APP_BASE_URL = "https://jmpboard.streamlit.app"

# Map configuration
DEFAULT_MAP_CENTER = [-6.7924, 39.2083]  # Default to Dar es Salaam
DEFAULT_MAP_ZOOM = 11

# Time configuration
DEFAULT_DEPARTURE_HOURS = 3
MAX_EXTENSION_HOURS = 24
ALERT_INTERVAL_MINUTES = 10

# Data refresh intervals (seconds)
PERSONNEL_CACHE_TTL = 60
DEPARTURES_CACHE_TTL = 30
GROUPS_CACHE_TTL = 60

# Google Sheets configuration
SHEET_NAMES = {
    'personnel': 'Personnel',
    'departures': 'Departures',
    'extensions': 'Extensions',
    'groups': 'Groups'
}

SHEET_HEADERS = {
    'personnel': ["name", "phone", "supervisor", "supervisor_phone", "company", "created_at", "updated_at"],
    'departures': ["id", "person_name", "destination", "departed_at", "expected_return", "actual_return", 
                  "phone", "supervisor", "company", "extensions_count", "is_overdue", "group_id", "last_location"],
    'extensions': ["id", "departure_id", "hours_extended", "extended_at", "gps_location"],
    'groups': ["id", "group_name", "members", "responsible_person", "created_at"]
}

def get_text(key, lang='en', **kwargs):
    """Get translated text with optional formatting"""
    text = LANGUAGES.get(lang, LANGUAGES['en']).get(key, key)
    if kwargs:
        return text.format(**kwargs)
    return text

def get_current_time():
    """Get current time in local timezone"""
    return datetime.now(LOCAL_TIMEZONE)

def format_time(dt, format_str='%I:%M %p'):
    """Format datetime to string"""
    if dt.tzinfo is None:
        dt = LOCAL_TIMEZONE.localize(dt)
    return dt.strftime(format_str)
